　　　　文/徐川　　来源：InfoQ（ID:infoqchina）　　小程序的尴尬：当平台方微信遇到了更“霸道”的平台方苹果。　　小程序曾经是在iOS和安卓上跨平台开发的完美解决方案，但现在，它已经被苹果重新关回了笼子里。　　据知情人士透露，苹果曾与微信在小程序和小游戏上接近达成协议，但最后功归一篑，不仅小游戏不能内购，连微信小程序iOS端都撤掉虚拟支付，甚至连相关标识都不能有。　　小程序和小游戏成为牵涉到苹果、谷歌、Facebook、腾讯诸多巨头的博弈焦点，这场博弈悄无声息，但身处漩涡中心的小程序，其未来已经蒙上一层阴影。　　一切，先从iOS虚拟支付说起。　　　　虚拟支付，顾名思义，就是针对虚拟物品的消费行为，包括你购买付费App、购买各种App会员、在游戏里充值消费、购买虚拟道具等等。　　凡是涉及到实体物品的都不是虚拟支付，比如你在淘宝剁手、用美团点外卖、购买火车票等。　　苹果规定，凡是在App Store上架的App，涉及到虚拟支付的，必须使用苹果提供的支付SDK，又叫做IAP（应用内支付），若涉及到实体支付的，可以用网银、支付宝等第三方支付。　　为什么会区别对待呢？因为国家针对实体商品已经收过税了，做实体经济的公司一般利润都很薄，如果苹果再抽成，这些公司的业务将难以为继。使用第三方支付，一般只需要付出1%以内的手续费，这个倒还能接受。　　目前尚没有国家针对虚拟商品和交易收税，苹果在iOS上自成王国，只要你想上App Store，就避免不了苹果的抽成，让人想起那句名言“唯有死亡和税收不可避免”。因此，也有人将苹果的这种分成行为称为“苹果税”，其税率为30%。　　在安卓平台上，情况会复杂一些。　　在国外，绝大多数App都选择通过谷歌Play商店来发布，谷歌学习苹果，同样规定收取30%的分成。但是，你也可以选择不通过Play商店发布App，这样开发者可以拥有所有收入，当下正火热的游戏“堡垒之夜”就在官网提供安卓App下载，没有上线Play商店。　　在国内，Play商店进不来，各个手机厂商都推出了自己的应用商店，在分成这块，可以说是群魔乱舞，相当随意，有些平台拿走的分成甚至高达50-90%。　　　　虚拟支付是纯互联网的玩法，无论是视频、音乐App的会员，还是线上课程、知识付费，都涉及到虚拟支付，这些都是人们在数字时代新业务模式的探索。　　苹果十分重视来自于App Store的分成，近几年的WWDC都会宣布他们给开发者分成了多少，将这个数字乘以3/7，大约就是苹果从App Store的收入。　　据苹果每年WWDC公开的数据估算，2017年，苹果从App Store获得收入是90亿美金左右，2018年，这个数字变成130亿，增长也还过得去。　　尽管这个数字对于苹果来说并不大，但有着特别的意义。　　一直以来，苹果都是一家硬件公司，很少从软件和内容中获得收入。而资本市场对于硬件公司的市盈率PE通常偏低，只有数倍左右，但互联网软件公司就不一样了，靠着讲故事，能够获得惊人的“市梦率”，比如常年亏损的亚马逊，其市盈率长时间高达百倍以上。　　苹果也需要讲故事来提升自己的市值，提高股票价格，从而回报投资者。而这个故事的主角就是App Store。　　iPhone将我们带入了移动互联网时代，而App Store则开创了“App经济”时代，作为这个时代幕后Boss的苹果，自然有理由获得高估值。至于资本市场买不买账，则是另一个故事。　　因此，维持App Store模式继续增长，可以说是苹果的重要战略方向之一，只要苹果觉得某些东西对这个战略有威胁，苹果就会毫不留情地打击，至少在iOS平台上，苹果非常严格地执行了这一策略，将所有有危险的萌芽消灭在襁褓中。　　这一策略的核心就在于对虚拟支付的严格控制（对跨平台的限制），之前的规定包括：iOS和Android平台相同游戏的数据不能互通，换一个平台，需要重新充值消费；严禁绕过App Store的支付，比如跳转到网页支付，一旦发现，就会进行严惩。　　小程序，就是在这个危险的边缘反复试探，苹果之前只是在警戒中监控，直到小程序碰到了虚拟支付这个雷区。　　　　事实上，微信做小程序，很早就和苹果打了招呼，得到了许可才做的。马化腾在朋友圈说，最开始小程序在内部叫应用号，但在苹果的压力下被迫改名。　　所以小程序之后的重大变化，苹果肯定提前知情。　　据知情人士透露，2017年底苹果与微信已经接近达成协议，让即将推出的小游戏可以使用微信支付。在此前，只有小程序支持微信支付，并且无论是实体还是虚拟支付都支持。　　然而在最后关头，某苹果高管推翻了协议，并提出新的条件：　　　　对微信来说，这显然是不可接受的，这么做小游戏将完全失去未来的想象空间。于是微信干脆在iOS端小游戏中撤掉支付，通过广告形式来变现，安卓端则仍然支持小游戏内购。　　苹果见微信并不屈服，又进一步要求，微信小程序也必须下线iOS端虚拟支付，其要求的严厉程度之高，甚至要求不允许出现任何引导支付的按钮或字样。　　2018年5月，微信小程序向开发者发布公告下线iOS虚拟支付，8月份，又发布修改指引，任何涉及到引导支付的地方也需要修改。　　2019年微信公开课Pro，我们向微信小程序官方询问iOS虚拟支付是否可能恢复，他们的答复是目前没有解决方案，也无法给出明确的解决时间，小程序目前的变现方式只有通过广告。　　然而微信不退让，从目前的情况来看，硬件销售不佳、股价下滑的苹果更不可能退让。　　微信和苹果各自的战略，在小程序和小游戏这里，发生了直接的碰撞。　　小程序未来会怎样？要了解这个问题，我们要回头看看过去发生了什么，接下来我会分析一下微信以及苹果、Facebook、谷歌三巨头在小程序及类似产品形态的探索，然后你会知道，小程序的未来如何，决定权在硅谷。　　　　讨论小程序的未来的时候，我们先要确认，它想变成什么样。很多人说小程序未来可以取代App和网页，但官方从来没有这么说过，看上去，是因为克制。　　但是，张小龙说，微信的字典里没有克制两个字，如果你听了他的四小时分享，会发现他的确不是克制，从一方面说是对底线的严守，另一方面，也可以说是对产品极强的控制欲。　　小程序的开发者只能在张小龙踩出的脚印上亦步亦趋，张小龙甚至不想让小程序发展的过快，按他说的，是不想让小程序变成流量红利。同时，在小程序初期，张小龙强调它需要与线下结合，用完即走，因为涉及到的支付就是实体支付，在苹果的允许范围内。　　也许正因为这种谨慎，苹果才让小程序得以生存。毕竟，苹果和微信之前在公众号赞赏上，已经有过一次冲突。　　这里我问各位读者一个问题，你认为公众号赞赏风波，最后苹果和微信谁赢了？　　看上去，是苹果退了一步，让公众号能够重新在iOS端赞赏，但实际上，是微信输了。　　微信虽然重新恢复了自己的产品功能，但是，公众号的创新之路被堵住了。在15、16年，网上流传公众号要做付费阅读，苹果这么一闹之后，再也没有这方面的动静。这两年知识付费火热，也似乎和公众号无关，微信沉寂两年之后的改版，则是探索不涉及付费的信息流。　　对于微信来说，肯定不想让公众号赞赏事件重演，所以必定会和苹果进行更密切的沟通。2017年9月，腾讯高层，包括马化腾、张小龙、刘炽平、任宇昕等前往苹果拜访，与库克见面沟通。随后在2018年的微信公开课上，张小龙宣布iOS端公众号赞赏将重新上线。　　这次拜访不仅为了解决公众号赞赏问题，也是为即将到来的小游戏铺路。对于小程序，由于它涉及到的营收没有那么大，所以苹果能睁只眼闭只眼，但游戏不一样，游戏的内购是App Store收入的重要来源，因此不得不慎重。　　然而，小程序能得到苹果的允许还可以说是苹果对它并不怎么理解，因为它只是国内的特产，但小游戏在国外已有类似的产品，所以苹果能明白它对自己的威胁。　　这个产品就是Facebook的InstantGames。　　　　Facebook很早就打造了自己的社交游戏平台并风靡一时，当移动互联网兴起后，Facebook也一直在寻找将社交游戏搬到移动设备的办法。　　最终，他们在旗下的移动即时聊天工具Messenger上推出了InstantGames，也作为这些聊天工具变现的一种手段。　　有消息说，2017年下半年，在微信与苹果沟通的前后，Facebook也与苹果进行了谈判。小游戏这种形式最终能发布，是微信和Facebook共同努力的结果。　　最终，InstantGames于2018年3月正式开放，在iOS端，它也去掉了支付功能；在安卓上，它接入了谷歌Play的应用内支付，在谷歌收取30%分成之后，它再收入剩下的30%，开发者最终可以得到49%的分成。　　对于Facebook来说，广告收入才是它的大头，这种社交游戏目前只是它扩大营收的一种途径。但是，有数十亿庞大用户基数的WhatsApp在，InstantGames的未来还是很有想象空间。　　　　世界上并不是只有微信和Facebook两家有聊天工具，其它公司看着微信和Facebook的做法，也必然会模仿，日本的Line就是其中的一个，它在日本和东南亚地区广受欢迎。　　2018年6月，Line宣布在其游戏平台上推出LineQuickGame（LQG），使用HTML5技术，点开即玩，与Facebook的InstantGames如出一辙。　　2018年10月，Line宣布LQG达到300万用户，然而紧接着从11月1号起，LQG的iOS端陷入长达50天的维护状态，据知情人士透露，其主要原因就是因为苹果施加压力，因为苹果担心HTML5游戏可能绕过苹果的支付方式。　　Line的遭遇不仅给同类想做小游戏的公司敲响了警钟，也让微信和Facebook不敢掉以轻心。苹果的做法是宣布它不会再让步了，对任何想绕过苹果的支付的行为都会予以坚决打击。　　苹果防止绕过应用内支付的技术也在持续升级，2018年11月，包括拼多多在内的1000多款App遭到苹果突然下架，后据调查，其中的原因就是因为使用了使用能改变原生代码功能的热更新技术。　　　　虽然谷歌模仿苹果设立了谷歌Play商店以及相应的规则，但对应用内支付的执行并不像苹果那么严格。　　据有海外开发经验的安卓开发者爆料称，在谷歌Play商店上，腾讯系和阿里系的应用，涉及到虚拟支付时多有采用自己的支付手段，而同类的其它公司应用却必须使用谷歌的应用内支付，因此猜测谷歌与腾讯阿里达成了某种协议。　　而对于微信小程序和小游戏，谷歌则干脆采取放任态度，你在谷歌Play下载的微信，可以获得和国内使用的同样体验。　　谷歌之所以能这样从容，一是因为谷歌Play的营收并不是公司的重心，另外则是谷歌自己也在开发类似的技术，即谷歌PlayInstant。　　Instant包括面向App和游戏两种形式，它是面向已有的App和游戏帮忙它们推出轻量和试玩版本，借助谷歌Play，它们可以做到无需下载，点开即玩，甚至可以和网页一样出现在谷歌搜索的结果里。　　微信小程序和小游戏对于谷歌来说，是值得参考的对象。2018年7月，谷歌推出了自己的“猜画小歌”微信小程序，不仅借助小程序平台宣传自己的AI技术，也有借这个机会了解小程序技术，一探微信虚实的意思。　　谷歌的Instant需要谷歌Play才能启用，因此只能在安卓平台生效，这和国内几个手机厂商推出的快应用差不多。但和微信小程序比，不能跨平台让它少了许多竞争力。但是，谷歌其实还藏有一个杀手锏。　　这个杀手锏就是PWA，一种面向未来的HTML5技术，让HTML5变得更像原生App。值得注意的是，这一技术得到了苹果和微软的支持，目前基本上所有的主流平台均已支持。　　PWA目前还缺乏直接调用系统API的能力，但是，这是一种天生对操作系统和搜索引擎友好的技术，只要PWA加上系统SDK并加入应用商店，立刻就能成为谷歌版“快应用”，可以和小程序正面竞争。　　更重要的是，PWA采用符合Web标准的HTML5技术，在长期来看，这种技术更具有生命力。　　　　苹果和谷歌对操作系统功能的变动、对应用商店政策的变化，都可能对小程序造成根本性的影响。而小程序做了什么，几乎无法对操作系统造成威胁，之前有人说小程序代表了微信可能成为构建于操作系统之上的另一层操作系统，但只要苹果不允许，微信只能做梦。　　小程序当然是有野心的，要不然，张小龙也不会选择在1月9日，iPhone诞生的十周年之际发布。但是现在，在苹果的严密关切下，小程序的边界止步于围墙花园。　　从目前来看，小程序最大的可能是继续在在苹果划定的框架之下存活，只要不威胁到苹果的营收，那么双方还是能相安无事。　　但未来还存在两个变数，其中一个就是将来某一时刻，如果苹果发现大家不开发App，都去做小程序了，它必然会有所动作，最大可能就是继续限制小程序的功能，让它无法和App一样。　　另外一个，则是越来越多的开发商开始反抗苹果税，比如Netflix每年从App Store获得数亿美元收入，但它现在已经不支持在iOS端的支付了。如果这种情况发展下去，App Store的虚拟支付条款可能名存实亡（游戏除外），iOSApp和安卓相比会变成功能残缺的版本，苹果显然也不会坐视这样的事情继续发生，未来，并不是没有可能取消虚拟支付的限制。　　看到这里，我想你应该明白了微信的确并不克制，如果真的克制，小程序不会推出虚拟支付，更不会冒险的推出小游戏。但是，在苹果的限制下，微信不得不表现的很“克制”，这种情况在较长的一段时间内都不会改变。只是可怜平台上的开发者，做个开发，还要关心巨头之间的争斗。